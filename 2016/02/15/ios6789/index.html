<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="适配," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="iOS6新特性
一、关于内存警告ios6中废除了viewDidUnload，viewWillUnload这两个系统回调，收到内存警告时在didReceiveMemoryWarning中进行相关的处理。123456789101112131415161718192021- (void)viewDidUnload &amp;#123;    [super viewDidUnload];    // 处理 ios">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS6、7、8、9新特性汇总和适配说明">
<meta property="og:url" content="http://jimmypeng.cn/2016/02/15/ios6789/index.html">
<meta property="og:site_name" content="J&M">
<meta property="og:description" content="iOS6新特性
一、关于内存警告ios6中废除了viewDidUnload，viewWillUnload这两个系统回调，收到内存警告时在didReceiveMemoryWarning中进行相关的处理。123456789101112131415161718192021- (void)viewDidUnload &amp;#123;    [super viewDidUnload];    // 处理 ios">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-bbbee5afa7d69be2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-149a58d6122ad36d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-19b99d5124647776.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-a6e3528bf458015d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-abd959abacad82b7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-75a082354660ff99.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-a031a45dc10b6d47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-6e80d5e7418c640c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-7ff5bfa5eb57e418.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-9d34f78d3daffa2f.gif?imageMogr2/auto-orient/strip">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-c756c23b4a7d1e69.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-c6900be6583fac27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:image" content="http://upload-images.jianshu.io/upload_images/1115674-28a5e236ded65e2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">
<meta property="og:updated_time" content="2016-09-24T08:01:13.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS6、7、8、9新特性汇总和适配说明">
<meta name="twitter:description" content="iOS6新特性
一、关于内存警告ios6中废除了viewDidUnload，viewWillUnload这两个系统回调，收到内存警告时在didReceiveMemoryWarning中进行相关的处理。123456789101112131415161718192021- (void)viewDidUnload &amp;#123;    [super viewDidUnload];    // 处理 ios">
<meta name="twitter:image" content="http://upload-images.jianshu.io/upload_images/1115674-bbbee5afa7d69be2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"right","display":"always"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 6333177780112459000,
      author: 'Jimmy'
    }
  };
</script>




  <link rel="canonical" href="http://jimmypeng.cn/2016/02/15/ios6789/"/>

  <title> iOS6、7、8、9新特性汇总和适配说明 | J&M </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans,en,default">

  



  <script type="text/javascript">
    var _hmt = _hmt || [];
    (function() {
      var hm = document.createElement("script");
      hm.src = "//hm.baidu.com/hm.js?15ff92f78d963406ab1037852d725472";
      var s = document.getElementsByTagName("script")[0];
      s.parentNode.insertBefore(hm, s);
    })();
  </script>








  
  
    
  

  <div class="container one-collumn sidebar-position-right page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">J&M</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">一个不会做实验的程序猿不是一个好厨子</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th-list"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-jm">
          <a href="/jm" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heart"></i> <br />
            
            J&M
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                iOS6、7、8、9新特性汇总和适配说明
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-02-15T09:07:29+08:00" content="2016-02-15">
              2016-02-15
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/iOS/" itemprop="url" rel="index">
                    <span itemprop="name">iOS</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
              <span class="post-comments-count">
                &nbsp; | &nbsp;
                <a href="/2016/02/15/ios6789/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/02/15/ios6789/" itemprop="commentsCount"></span>
                </a>
              </span>
            
          

          

          
          

          
              &nbsp; | &nbsp;
              <span class="page-pv"><i class="fa fa-file-o"></i>
              <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>
              </span>
          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="iOS6新特性"><a href="#iOS6新特性" class="headerlink" title="iOS6新特性"></a>iOS6新特性</h1><hr>
<h5 id="一、关于内存警告"><a href="#一、关于内存警告" class="headerlink" title="一、关于内存警告"></a>一、关于内存警告</h5><p>ios6中废除了viewDidUnload，viewWillUnload这两个系统回调，收到内存警告时在didReceiveMemoryWarning中进行相关的处理。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">- (void)viewDidUnload &#123;</div><div class="line">    [super viewDidUnload];</div><div class="line">    // 处理 ios6 以下的系统内存警告系统回调消息</div><div class="line">&#125;</div><div class="line"> </div><div class="line">// 这里处理ios6 的内存警告</div><div class="line">- (void)didReceiveMemoryWarning &#123;</div><div class="line">    [super didReceiveMemoryWarning];</div><div class="line">    </div><div class="line">    float sysVer = [[[UIDevice currentDevice] systemVersion] floatValue];</div><div class="line">    //ios6 的特殊处理</div><div class="line">    </div><div class="line">    if (sysVer &gt;= 6.0f) &#123;</div><div class="line">        // 保证 invisible,  因为即使在当前界面也会收到系统回调</div><div class="line">        if (self.view.window == nil) &#123;</div><div class="line">            //.......</div><div class="line">            // 做相关的释放操作</div><div class="line">            self.view = nil;   // 确保下次会重新加载</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<a id="more"></a>
<h5 id="二、关于屏幕旋转"><a href="#二、关于屏幕旋转" class="headerlink" title="二、关于屏幕旋转"></a>二、关于屏幕旋转</h5><p>同样ios6 废除了shouldAutorotateToInterfaceOrientation这个旋转屏幕的设置接口。</p>
<p>必须在两个新接口中设置旋转属性:shouldAutorotate、supportedInterfaceOrientations。</p>
<p>收到旋转事件后的处理，同样在willRotateToInterfaceOrientation和didRotateFromInterfaceOrientation中进行。</p>
<h5 id="三、UISwitch"><a href="#三、UISwitch" class="headerlink" title="三、UISwitch"></a>三、UISwitch</h5><p>ios6下，新增了以下几个属性，可以设置开关的颜色以及背景图。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">@property (nonatomic,  retain) UIColor *tintColor;</div><div class="line"> </div><div class="line">@property (nonatomic,  retain) UIColor *thumbTintColor;</div><div class="line"> </div><div class="line">@property (nonatomic,  retain) UIImage *onImage;</div><div class="line"> </div><div class="line">@property (nonatomic,  retain) UIImage *offImage;</div></pre></td></tr></table></figure>
<h5 id="四、UINavigationBar"><a href="#四、UINavigationBar" class="headerlink" title="四、UINavigationBar"></a>四、UINavigationBar</h5><p>ios6新增了，设置阴影图片的属性。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@property (nonatomic, retain) UIImage *shadowImage;</div></pre></td></tr></table></figure>
<h5 id="五、UIImage"><a href="#五、UIImage" class="headerlink" title="五、UIImage"></a>五、UIImage</h5><p>可以在ios6下设置图片的scale比例尺寸了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">+ (UIImage *)imageWithData:(NSData *)data scale:(CGFloat)scale;</div><div class="line"> </div><div class="line">- (id)initWithData:(NSData *)data scale:(CGFloat)scale;</div></pre></td></tr></table></figure>
<h5 id="六、UIRefreshControl"><a href="#六、UIRefreshControl" class="headerlink" title="六、UIRefreshControl"></a>六、UIRefreshControl</h5><p>之前苹果官方是没有现成的下拉刷新的控件，都是自己实现或者使用比较成熟的开源库。</p>
<p>ios6苹果加入了UIRefreshControl，配合UITableView直接实现下拉刷新。</p>
<h5 id="七、UICollectionView"><a href="#七、UICollectionView" class="headerlink" title="七、UICollectionView"></a>七、UICollectionView</h5><p>全新的集合控件，应用场景有类似照片墙，瀑布流等。</p>
<h1 id="iOS7新特性"><a href="#iOS7新特性" class="headerlink" title="iOS7新特性"></a>iOS7新特性</h1><hr>
<h5 id="一、已禁用-UIDevice-uniqueIdentifier"><a href="#一、已禁用-UIDevice-uniqueIdentifier" class="headerlink" title="一、已禁用-[UIDevice uniqueIdentifier]"></a>一、已禁用-[UIDevice uniqueIdentifier]</h5><p>苹果总是把用户的隐私看的很重要。-[UIDevice uniqueIdentifier]在iOS5实际在iOS5的时候已经被遗弃了，但是iOS7中已经完全的禁用了它。Xcode5甚至不会允许你编译包含了指引到-[UIDevice uniqueIdentifier]的app。</p>
<p>此外，iOS7之前的使用了-[UIDevice uniqueIdentifier] 的app如果在iOS7上运行，它不会返回设备的UUID，而是会返回一串字符串，以FFFFFFFF开头，跟着-[UIDevice identifierForVendor]的十六进制值。</p>
<h5 id="二、UIPasteboard由共享变为沙盒化了"><a href="#二、UIPasteboard由共享变为沙盒化了" class="headerlink" title="二、UIPasteboard由共享变为沙盒化了"></a>二、UIPasteboard由共享变为沙盒化了</h5><p>UIPasteboard过去是用来做app之间的数据分享的。UIPasteboard本无问题，但是开发者开始使用它来存储标识符，和其他的相关app分享这些标识符的时候问题就出现了。有一个使用这种把戏的就是OpenUDID。</p>
<p>在iOS7中，使用 +[UIPasteboard pasteboardWithName:create:]和 +[UIPasteboard pasteboardWithUniqueName]创建剪贴板，而且只对相同的app group可见，这样就让OpenUDID不那么有用了。</p>
<h5 id="三、MAC地址不能再用来设别设备"><a href="#三、MAC地址不能再用来设别设备" class="headerlink" title="三、MAC地址不能再用来设别设备"></a>三、MAC地址不能再用来设别设备</h5><p>还有一个生成iOS设备唯一标示符的方法是使用iOS设备的Media Access Control（MAC）地址。一个MAC地址是一个唯一的号码，它是物理网络层级方面分配给网络适配器的。这个地址苹果还有其他的名字，比如说是硬件地址（Hardware Address)或是Wifi地址，都是指同样的东西。</p>
<p>有很多工程和框架都使用这个方法来生成唯一的设备ID。比如说ODIN。然而，苹果并不希望有人通过MAC地址来分辨用户，所以如果你在iOS7系统上查询MAC地址，它现在只会返回02:00:00:00:00:00。</p>
<p>现在苹果明确的表明你应该使用-[UIDevice identifierForVendor]或是-[ASIdentifierManager advertisingIdentifier]来作为你框架和应用的唯一标示符。坦白的来说，应对这些变化也不是那么的难，见以下代码片段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSString *identifierForVendor = [[UIDevice currentDevice].identifierForVendor UUIDString];</div><div class="line"> </div><div class="line">NSString *identifierForAdvertising = [[ASIdentifierManager sharedManager].advertisingIdentifier UUIDString];</div></pre></td></tr></table></figure>
<p>每种方法都适配一种特别的用法：</p>
<p>identifierForVendor对供应商来说是唯一的一个值，也就是说，由同一个公司发行的的app在相同的设备上运行的时候都会有这个相同的标识符。然而，如果用户删除了这个供应商的app然后再重新安装的话，这个标识符就会不一致。</p>
<p>advertisingIdentifier会返回给在这个设备上所有软件供应商相同的 一个值，所以只能在广告的时候使用。这个值会因为很多情况而有所变化，比如说用户初始化设备的时候便会改变。</p>
<h5 id="四、iOS现在要求app如需使用麦克风，需要征得用户同意"><a href="#四、iOS现在要求app如需使用麦克风，需要征得用户同意" class="headerlink" title="四、iOS现在要求app如需使用麦克风，需要征得用户同意"></a>四、iOS现在要求app如需使用麦克风，需要征得用户同意</h5><p>以前如果app需要使用用户的位置，通讯录，日历，提醒以及照片，接受推送消息，使用用户的社交网络的时候需要征得用户的同意。现在在iOS7当中，使用麦克风也需要取得用户同意了。如果用户不允许app使用麦克风的话，那么需要使用麦克风的app就不能接收不到任何声音。</p>
<p>以下的代码是用来查询用户是否允许app使用麦克风：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//第一次调用这个方法的时候，系统会提示用户让他同意你的app获取麦克风的数据</div><div class="line">// 其他时候调用方法的时候，则不会提醒用户</div><div class="line">// 而会传递之前的值来要求用户同意</div><div class="line">[[AVAudioSession sharedInstance] requestRecordPermission:^(BOOL granted) &#123;</div><div class="line">    if (granted) &#123;</div><div class="line">        // 用户同意获取数据</div><div class="line">    &#125; else &#123;</div><div class="line">        // 可以显示一个提示框告诉用户这个app没有得到允许？</div><div class="line">    &#125;</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<p>你同时还要注意，如果你在获得用户的同意之前使用任何方法来使用麦克风的话，会引起iOS系统弹出以下警示栏：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1115674-bbbee5afa7d69be2.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4673_140117110443_1.jpg"></p>
<h5 id="五、-NSArray-firstObject-的实现"><a href="#五、-NSArray-firstObject-的实现" class="headerlink" title="五、[NSArray firstObject]的实现"></a>五、[NSArray firstObject]的实现</h5><p><code>-[NSArray firstObject]可能是Objective-C中被调用做多的API。在Open Radar上一个简单的调查显示有一些需求苹果已经做了记录。好消息是现在这些需求已经得到了解决。. firstObject的使用可以追溯到iOS4.0，但是那时仅仅是一个私有方法。在iOS7以前，工程师用下面的方式来使用它：</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">NSArray *arr = @[];</div><div class="line">id item = [arr firstObject];</div><div class="line"></div><div class="line">// 在之前你需要做以下工作</div><div class="line">id item = [arr count] &gt; 0 ? arr[0] : nil;</div></pre></td></tr></table></figure>
<p>因为上面的方式很平常，有些人将它作为一个类增加到NSArray中，然后创建他们自己的firstObject方法。</p>
<p>这个方法的问题是这个方法的名字必须是唯一的，否则的话这个方法所引发的问题无法预估。</p>
<p>请确保检查你是否有任何自定义的代码在NSArray上实现了firstObject，如果有的话看看它是否是必须的，不是必须的话就把它全部移除。</p>
<h5 id="六、增加了instancetype"><a href="#六、增加了instancetype" class="headerlink" title="六、增加了instancetype"></a>六、增加了instancetype</h5><p>instancetype让iOS7API变得更加难懂。苹果改变了大部分 initializer和简易构造函数（convenience constructors），用instancetype代替id作返回类型。但是这个instancetype是什么呢？</p>
<p>instancetype用来在声明一个方法时告诉编译器其返回类型，它表示返回调用该方法的类的对象。</p>
<p>这比之前返回id的通常做法要好，编译器可以对返回类型做一些检查，如果出现错误，在编译时就能提醒你，而不是在程序运行时发生崩溃。</p>
<p>同时，在调用子类方法时，使用它还可以省去对返回值的强制类型转换，编译器能够正确推断方法的返回值类型。</p>
<p>要说到instancetaype的缺点和优点吗？基本上，在任何可能的情况下都可以使用它。</p>
<h5 id="七、设置UIImage的渲染模式：UIImage-renderingMode"><a href="#七、设置UIImage的渲染模式：UIImage-renderingMode" class="headerlink" title="七、设置UIImage的渲染模式：UIImage.renderingMode"></a>七、设置UIImage的渲染模式：UIImage.renderingMode</h5><p>着色（Tint Color）是iOS7界面中的一个重大改变，你可以设置一个UIImage在渲染时是否使用当前视图的Tint Color。</p>
<p>UIImage新增了一个只读属性：renderingMode，对应的还有一个新增方法：imageWithRenderingMode:，它使用UIImageRenderingMode枚举值来设置图片的renderingMode属性。该枚举中包含下列值：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// 根据图片的使用环境和所处的绘图上下文自动调整渲染模式</div><div class="line">UIImageRenderingModeAutomatic </div><div class="line"> </div><div class="line">// 始终绘制图片原始状态，不使用Tint Color</div><div class="line">UIImageRenderingModeAlwaysOriginal </div><div class="line"> </div><div class="line">// 始终根据Tint Color绘制图片，忽略图片的颜色信息</div><div class="line">UIImageRenderingModeAlwaysTemplate</div></pre></td></tr></table></figure>
<p>renderingMode属性的默认值是UIImageRenderingModeAutomatic，即UIImage是否使用Tint Color取决于它显示的位置。其他情况可以看下面的图例：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1115674-149a58d6122ad36d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2.png"></p>
<p>以下的代码说明了使用一个既定的rendering模式创建图片是多么简单：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">UIImage *img = [UIImage imageNamed:@&quot;myimage&quot;];</div><div class="line"> </div><div class="line">img = [img imageWithRenderingMode:UIImageRenderingModeAlwaysTemplate];</div></pre></td></tr></table></figure>
<h5 id="八、tintcolor-VS-barTintColor"><a href="#八、tintcolor-VS-barTintColor" class="headerlink" title="八、tintcolor VS barTintColor"></a>八、tintcolor VS barTintColor</h5><p>iOS7中你可以使用一个给定的颜色，甚至是记入颜色主题来给整个app着色，帮助你的app脱颖而出。设置app的tint color很简答，只要使用UIView的新属性tintColor即可。</p>
<p>这个属性是否听上去很熟悉呢？应该很熟悉，有些类，比如说UINaviagtionBar，UISearchBar，UITabBar以及UIToolbar已经有了这么命名的属性。他们现在有了一个新的属性：barTintColor。</p>
<p>为了避免使用新属性的时候犯错误，如果你的appp需要支持iOS6以前的系统的时候，请检查一下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">UINavigationBar *bar = self.navigationController.navigationBar;</div><div class="line">UIColor *color = [UIColor greenColor];</div><div class="line"> </div><div class="line">if ([bar respondsToSelector:@selector(setBarTintColor:)]) &#123; // iOS 7+</div><div class="line">    bar.barTintColor = color;</div><div class="line">&#125; else &#123; // what year is this? 2012?</div><div class="line">    bar.tintColor = color;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="九、去掉了纹理颜色"><a href="#九、去掉了纹理颜色" class="headerlink" title="九、去掉了纹理颜色"></a>九、去掉了纹理颜色</h5><p><img src="http://upload-images.jianshu.io/upload_images/1115674-19b99d5124647776.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt=""></p>
<p>纹理颜色？对，不再使用他们了，不能再创建可以展现纹理的颜色。</p>
<p>根据UIInterface.h文件中的注释，-[UIColor groupTableViewBackgroundColor]应该是要在iOS6当中即被删除了，但是它仅仅只是不像之前那样返回纹理颜色了。然而，以下的颜色在iOS7当中被删除了:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">+ (UIColor *)viewFlipsideBackgroundColor;</div><div class="line"> </div><div class="line">+ (UIColor *)scrollViewTexturedBackgroundColor;</div><div class="line"> </div><div class="line">+ (UIColor *)underPageBackgroundColor;</div></pre></td></tr></table></figure>
<h5 id="十、UIButtonTypeRoundRect被UIButtonTypeSystem取代了"><a href="#十、UIButtonTypeRoundRect被UIButtonTypeSystem取代了" class="headerlink" title="十、UIButtonTypeRoundRect被UIButtonTypeSystem取代了"></a>十、UIButtonTypeRoundRect被UIButtonTypeSystem取代了</h5><p><img src="http://upload-images.jianshu.io/upload_images/1115674-a6e3528bf458015d.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="4.jpg"></p>
<p>在iOS开发刚开始就陪伴着你的老朋友现在也被删除了，它就是UIButtonTypeRoundRect ，被新的UIButtonTypeSystem取代了。</p>
<p>如果每次iOS系统的发布都没有一些新的功能会是什么样子？这些新功能相信大部分开发者已经知道了，你可能会发现一些新颖的方式将它们整合到你的app中去！</p>
<h5 id="十一、检查无线路由是否可用"><a href="#十一、检查无线路由是否可用" class="headerlink" title="十一、检查无线路由是否可用"></a>十一、检查无线路由是否可用</h5><p>定制一个视频播放器的能力在iOS版本每次的发布中一直有所进步。比如说，在iOS6之前，你不能在MPVolumeView中改变AirPlay的icon。</p>
<p>在iOS7当中，你可以通过AirPlay，蓝牙或是其他的虚线机制了解是否有一个远程的设备可用。了解它的话，就可以让你的app在恰当的时候做恰当的事，比如说，在没有远程设备的时候就不显示AirPlay的icon。</p>
<p>以下是新增加到MPVolumeView的新属性和推送</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">@property (nonatomic, readonly) BOOL wirelessRoutesAvailable; //  是否有设备可以连接的无线线路？</div><div class="line">@property (nonatomic, readonly) BOOL wirelessRouteActive; // 设备现在是否连接上了网络</div><div class="line">NSString *const MPVolumeViewWirelessRoutesAvailableDidChangeNotification;</div><div class="line">NSString *const MPVolumeViewWirelessRouteActiveDidChangeNotification;</div></pre></td></tr></table></figure>
<h5 id="十二、了解蜂窝网络"><a href="#十二、了解蜂窝网络" class="headerlink" title="十二、了解蜂窝网络"></a>十二、了解蜂窝网络</h5><p>在iOS7之前，是使用Reachability来检测设备是否连接到WWAN或是Wifi的。iOS7在这个基础上更进了一步，它会告诉你的设备连接上的是那种蜂窝网络，比如说是Edge网络，HSDPA网络，或是LTE网络。告诉用户他们连接上的是哪种网络可以优化用户体验，因为这样他们会知道网速如何，不会去请求需要高网速的网络请求。</p>
<p>这是CTTelephonyNetworkInfo的部分功能，它是CoreTelephony框架的一部分。iOS7还增加了currentRadioAccessTechnology属性和CTRadioAccessTechnologyDidChangeNotification到这个类。还有一些新的字符串常量来定义可能的值，比如说是CTRadioAccessTechnologyLTE。</p>
<p>以下代码告诉你在app delegate中如何使用这个新功能：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">@import CoreTelephony.CTTelephonyNetworkInfo; // new modules syntax!</div><div class="line">@interface AppDelegate ()</div><div class="line">// we need to keep a reference to the CTTelephonyNetworkInfo object, otherwise the notifications won&apos;t be fired!</div><div class="line">@property (nonatomic, strong) CTTelephonyNetworkInfo *networkInfo;</div><div class="line">@end</div><div class="line"> </div><div class="line">@implementation ViewController</div><div class="line"> </div><div class="line">- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123;</div><div class="line">    // whatever stuff your method does...</div><div class="line">    </div><div class="line">    self.networkInfo = [[CTTelephonyNetworkInfo alloc] init];</div><div class="line">    NSLog(@&quot;Initial cell connection: %@&quot;, self.networkInfo.currentRadioAccessTechnology);</div><div class="line">    [[NSNotificationCenter defaultCenter] addObserver:self selector:@selector(radioAccessChanged) name:</div><div class="line">     CTRadioAccessTechnologyDidChangeNotification object:nil];</div><div class="line">    </div><div class="line">    // whatever stuff your method does...</div><div class="line">&#125;</div><div class="line"> </div><div class="line">- (void)radioAccessChanged &#123;</div><div class="line">    NSLog(@&quot;Now you&apos;re connected via %@&quot;, self.networkInfo.currentRadioAccessTechnology);</div><div class="line">&#125;</div><div class="line"> </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>注意：研究一下CTTelephonyNetworkInfo.h 文件来看看是否有其他无线网络类型的的字符串常量。如果设备没有连上的话，currentRadioAccessTechnology 则会返回nil。</p>
<h5 id="十三、通过iCloud同步用户设备的密码"><a href="#十三、通过iCloud同步用户设备的密码" class="headerlink" title="十三、通过iCloud同步用户设备的密码"></a>十三、通过iCloud同步用户设备的密码</h5><p>iOS7以及Mavericks增加了iCloud Keychain来提供密码，以及iCloud中一些敏感数据的同步。开发者可以通过keychain中的kSecAttrSynchronizable key来遍历dictionary对象。</p>
<p>由于直接处理keychain比较难，封装库提供了一个简单的处理keychain的方法。SSKeychain封装库可能是最有名的的一个，作为一种福利，现在它支持在iCloud同步。</p>
<p>以下代码片段显示了如何使用SSKeychain：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">#import &lt;SSKeychain.h&gt;</div><div class="line"> </div><div class="line">- (BOOL)saveCredentials:(NSError **)error &#123;</div><div class="line">    SSKeychainQuery *query = [[SSKeychainQuery alloc] init];</div><div class="line">    query.password = @&quot;MySecretPassword&quot;;</div><div class="line">    query.service = @&quot;MyAwesomeService&quot;;</div><div class="line">    query.account = @&quot;John Doe&quot;;</div><div class="line">    query.synchronizable = YES;</div><div class="line">    return [query save:&amp;error];</div><div class="line">&#125;</div><div class="line"> </div><div class="line">- (NSString *)savedPassword:(NSError **)error &#123;</div><div class="line">    SSKeychainQuery *query = [[SSKeychainQuery alloc] init];</div><div class="line">    query.service = @&quot;MyAwesomeService&quot;;</div><div class="line">    query.account = @&quot;John Doe&quot;;</div><div class="line">    query.synchronizable = YES;</div><div class="line">    query.password = nil;</div><div class="line">    if ([query fetch:&amp;error]) &#123;</div><div class="line">        return query.password;</div><div class="line">    &#125;</div><div class="line">    return nil;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>不要忘记CocoaPods是快速便捷安装SSKeychian的好方法。</p>
<h5 id="十四、使用NSAttributedString显示HTML"><a href="#十四、使用NSAttributedString显示HTML" class="headerlink" title="十四、使用NSAttributedString显示HTML"></a>十四、使用NSAttributedString显示HTML</h5><p>在app中使用webview有时会让人非常沮丧，即使只是显示少量的HTMLneirong ,webview也会消耗大量的内存。现在iOS7让这些变得简单了，你可以从用少量代码在HTML文件中创建一个NSAttributedString，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">NSString *html = @&quot;&lt;bold&gt;Wow!&lt;/bold&gt; Now &lt;em&gt;iOS&lt;/em&gt; can create &lt;h3&gt;NSAttributedString&lt;/h3&gt; from HTMLs!&quot;;</div><div class="line">NSDictionary *options = @&#123;NSDocumentTypeDocumentAttribute: NSHTMLTextDocumentType&#125;;</div><div class="line"> </div><div class="line">NSAttributedString *attrString = [[NSAttributedString alloc] initWithData:[html dataUsingEncoding:NSUTF8StringEncoding] options:options documentAttributes:nil error:nil];</div></pre></td></tr></table></figure>
<p>现在你可以在任意的UIKit对象上使用NSAttributedString 了，比如说是一个UILabel或是一个UITextField。</p>
<p>注意：NSHTMLTextDocumentType 只是NSDocumentTypeDocumentAttribute key一种可能的值。你还可以使用NSPlainTextDocumentType，NSRTFTextDocumentType或是NSRTFDTextDocumentType。</p>
<p>你还可以从NSAttributedString中创建一个HTML字符串，如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">NSAttributedString *attrString; // from previous code</div><div class="line">NSDictionary *options = @&#123;NSDocumentTypeDocumentAttribute: NSHTMLTextDocumentType&#125;;</div><div class="line"> </div><div class="line">NSData *htmlData = [attrString dataFromRange:NSMakeRange(0, [attrString length]) documentAttributes:options error:nil];</div><div class="line">NSString *htmlString = [[NSString alloc] initWithData:htmlData encoding:NSUTF8StringEncoding];</div></pre></td></tr></table></figure>
<p>现在你估计在app中会更多的使用HTML了。</p>
<h5 id="十五、使用原生的Base64"><a href="#十五、使用原生的Base64" class="headerlink" title="十五、使用原生的Base64"></a>十五、使用原生的Base64</h5><p>Base64是使用ASCII码显示二进制数据的一种流行方法。直到现在，开发者还不得不使用开源的工具来编码解码Base64的内容。</p>
<p>现在iOS7引入了以下四种新的NSData方法来操作Base64编码的数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">// From NSData.h</div><div class="line">- (id)initWithBase64EncodedString:(NSString *)base64String options:(NSDataBase64DecodingOptions)options;</div><div class="line"> </div><div class="line">- (NSString *)base64EncodedStringWithOptions:(NSDataBase64EncodingOptions)options;</div><div class="line"> </div><div class="line">- (id)initWithBase64EncodedData:(NSData *)base64Data options:(NSDataBase64DecodingOptions)options;</div><div class="line"> </div><div class="line">- (NSData *)base64EncodedDataWithOptions:(NSDataBase64EncodingOptions)options;</div></pre></td></tr></table></figure>
<p>这些方法可以帮助你轻易的将NSData对象转化为Base64，或者将Base64转化为NSData object。见以下的例子：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">NSData* sampleData = [@&quot;Some sample data&quot; dataUsingEncoding:NSUTF8StringEncoding];</div><div class="line"> </div><div class="line">NSString * base64String = [sampleData base64EncodedStringWithOptions:0];</div><div class="line">NSLog(@&quot;Base64-encoded string is %@&quot;, base64String); // prints &quot;U29tZSBzYW1wbGUgZGF0YQ==&quot;</div><div class="line"> </div><div class="line">NSData* dataFromString = [[NSData alloc] initWithBase64EncodedString:base64String options:0];</div><div class="line">NSLog(@&quot;String is %@&quot;,[NSString stringWithUTF8String:[dataFromString bytes]]); // prints &quot;String is Some sample data&quot;</div></pre></td></tr></table></figure>
<p>如果你需要支持iOS6或者更早以前的系统，你可以使用以下两个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">/* These methods first appeared in NSData.h on OS X 10.9 and iOS 7.0. They are deprecated in the same releases in favor of</div><div class="line"> the methods in the &lt;code&gt;NSDataBase64Encoding&lt;/code&gt; category. However, these methods have existed for several releases, so</div><div class="line"> they may be used for applications targeting releases prior to OS X 10.9 and iOS 7.0.</div><div class="line"> */</div><div class="line">- (id)initWithBase64Encoding:(NSString *)base64String;</div><div class="line">- (NSString *)base64Encoding;</div></pre></td></tr></table></figure>
<h5 id="十六、使用UIApplicationUserDidTakeScreenshotNotification来检查截图"><a href="#十六、使用UIApplicationUserDidTakeScreenshotNotification来检查截图" class="headerlink" title="十六、使用UIApplicationUserDidTakeScreenshotNotification来检查截图"></a>十六、使用UIApplicationUserDidTakeScreenshotNotification来检查截图</h5><p>在iOS7之前，像Snapshot或是Facebook Poke这样的app是使用一些很精巧的方法来检测用户是否有截图。然而，iOS7提供一个崭新的推送方法：UIApplicationUserDidTakeScreenshotNotification。只要像往常一样订阅即可知道什么时候截图了。</p>
<p>注意：UIApplicationUserDidTakeScreenshotNotification 将会在截图完成之后显示。现在在截图截取之前无法得到通知。希望苹果会在iOS8当中增加UIApplicationUserWillTakeScreenshotNotification。</p>
<h5 id="十七、实现多语言语音合成"><a href="#十七、实现多语言语音合成" class="headerlink" title="十七、实现多语言语音合成"></a>十七、实现多语言语音合成</h5><p>如果可以让app说话会不会很好呢？iOS7加入了两个新类：AVSpeechSynthesizer 以及AVSpeechUtterance。这两个类可以给你的app发声。很有意思不是吗？有多种语言可供选择——Siri不会说的语言也有，比如说巴西葡萄牙语。</p>
<p>使用这两个类给app提供语言合成的功能非常简单。AVSpeechUtterance 代表你想说什么，如何说。AVSpeechSynthesizer 用来发出这些声音，见以下代码片段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">AVSpeechSynthesizer *synthesizer = [[AVSpeechSynthesizer alloc] init];</div><div class="line">AVSpeechUtterance *utterance =</div><div class="line">[AVSpeechUtterance speechUtteranceWithString:@&quot;Wow, I have such a nice voice!&quot;];</div><div class="line">utterance.rate = AVSpeechUtteranceMaximumSpeechRate / 4.0f;</div><div class="line">utterance.voice = [AVSpeechSynthesisVoice voiceWithLanguage:@&quot;en-US&quot;]; // defaults to your system language</div><div class="line">[synthesizer speakUtterance:utterance];</div></pre></td></tr></table></figure>
<h5 id="十八、使用了新的UIScreenEdgePanGestureRecognizer"><a href="#十八、使用了新的UIScreenEdgePanGestureRecognizer" class="headerlink" title="十八、使用了新的UIScreenEdgePanGestureRecognizer"></a>十八、使用了新的UIScreenEdgePanGestureRecognizer</h5><p>UIScreenEdgePanGestureRecognizer 继承自UIPanGestureRecognizer ，它可以让你从屏幕边界即可检测手势。</p>
<p>使用新的手势识别器很简单，见以下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">UIScreenEdgePanGestureRecognizer *recognizer = [[UIScreenEdgePanGestureRecognizer alloc] initWithTarget:self action:@selector(handleScreenEdgeRecognizer:)];</div><div class="line">recognizer.edges = UIRectEdgeLeft;</div><div class="line">[self.view addGestureRecognizer:recognizer];</div></pre></td></tr></table></figure>
<h5 id="十九、使用UIScrollViewKeyboardDismissMode实现了Message-app的行为"><a href="#十九、使用UIScrollViewKeyboardDismissMode实现了Message-app的行为" class="headerlink" title="十九、使用UIScrollViewKeyboardDismissMode实现了Message app的行为"></a>十九、使用UIScrollViewKeyboardDismissMode实现了Message app的行为</h5><p>像Messages app一样在滚动的时候可以让键盘消失是一种非常好的体验。然而，将这种行为整合到你的app很难。幸运的是，苹果给UIScrollView添加了一个很好用的属性keyboardDismissMode，这样可以方便很多。</p>
<p>现在仅仅只需要在Storyboard中改变一个简单的属性，或者增加一行代码，你的app可以和办到和Messages app一样的事情了。</p>
<p>这个属性使用了新的UIScrollViewKeyboardDismissMode enum枚举类型。这个enum枚举类型可能的值如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">UIScrollViewKeyboardDismissModeNone        // the keyboard is not dismissed automatically when scrolling</div><div class="line">UIScrollViewKeyboardDismissModeOnDrag      // dismisses the keyboard when a drag begins</div><div class="line">UIScrollViewKeyboardDismissModeInteractive // the keyboard follows the dragging touch off screen, and may be</div><div class="line">pulled upward again to cancel the dismiss</div></pre></td></tr></table></figure>
<p>以下是让键盘可以在滚动的时候消失需要设置的属性：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1115674-abd959abacad82b7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="5.png"></p>
<h5 id="二十、使用Core-Image来检测眨眼以及微笑"><a href="#二十、使用Core-Image来检测眨眼以及微笑" class="headerlink" title="二十、使用Core Image来检测眨眼以及微笑"></a>二十、使用Core Image来检测眨眼以及微笑</h5><p>iOS给Core Image增加了两种人脸检测功能：CIDetectorEyeBlink以及CIDetectorSmile。这也就是说你现在可以在照片中检测微笑以及眨眼。</p>
<p>以下是在app中使用它的方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">UIImage *image = [UIImage imageNamed:@&quot;myImage&quot;];</div><div class="line">CIDetector *detector = [CIDetector detectorOfType:CIDetectorTypeFace</div><div class="line">                                          context:nil</div><div class="line">                                          options:@&#123;CIDetectorAccuracy: CIDetectorAccuracyHigh&#125;];</div><div class="line"> </div><div class="line">NSDictionary *options = @&#123; CIDetectorSmile: @YES, CIDetectorEyeBlink: @YES &#125;;</div><div class="line"> </div><div class="line">NSArray *features = [detector featuresInImage:image.CIImage options:options];</div><div class="line"> </div><div class="line">for (CIFaceFeature *feature in features) &#123;</div><div class="line">    NSLog(@&quot;Bounds: %@&quot;, NSStringFromCGRect(feature.bounds));</div><div class="line">    </div><div class="line">    if (feature.hasSmile) &#123;</div><div class="line">        NSLog(@&quot;Nice smile!&quot;);</div><div class="line">    &#125; else &#123;</div><div class="line">        NSLog(@&quot;Why so serious?&quot;);</div><div class="line">    &#125;</div><div class="line">    if (feature.leftEyeClosed || feature.rightEyeClosed) &#123;</div><div class="line">        NSLog(@&quot;Open your eyes!&quot;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h5 id="二十一、给UITextView增加了链接"><a href="#二十一、给UITextView增加了链接" class="headerlink" title="二十一、给UITextView增加了链接"></a>二十一、给UITextView增加了链接</h5><p>现在在iOS添加你自己的Twitter账户更加简单了，现在你可以给一个NSAttributedString增加链接了，然后当它被点击的时候唤起一个定制的action。</p>
<p>首先，创建一个NSAttributedString然后增加给它增加一个NSLinkAttributeName 属性，见以下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">NSMutableAttributedString *attributedString = [[NSMutableAttributedString alloc] initWithString:@&quot;This is an example by @marcelofabri_&quot;];</div><div class="line">[attributedString addAttribute:NSLinkAttributeName</div><div class="line">                         value:@&quot;username://marcelofabri_&quot;</div><div class="line">                         range:[[attributedString string] rangeOfString:@&quot;@marcelofabri_&quot;]];</div><div class="line"> </div><div class="line"> </div><div class="line">NSDictionary *linkAttributes = @&#123;NSForegroundColorAttributeName: [UIColor greenColor],</div><div class="line">                                 NSUnderlineColorAttributeName: [UIColor lightGrayColor],</div><div class="line">                                 NSUnderlineStyleAttributeName: @(NSUnderlinePatternSolid)&#125;;</div><div class="line"> </div><div class="line">// assume that textView is a UITextView previously created (either by code or Interface Builder)</div><div class="line">textView.linkTextAttributes = linkAttributes; // customizes the appearance of links</div><div class="line">textView.attributedText = attributedString;</div><div class="line">textView.delegate = self;</div></pre></td></tr></table></figure>
<p>这样就可以让链接在文本中显示。然而，你也可以控制当链接被点击的时候会发生什么，实现这个可以使用UITextViewDelegate协议的新的shouldInteractWithURL方法，就像这样：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (BOOL)textView:(UITextView *)textView shouldInteractWithURL:(NSURL *)URL inRange:(NSRange)characterRange &#123;</div><div class="line">    if ([[URL scheme] isEqualToString:@&quot;username&quot;]) &#123;</div><div class="line">        NSString *username = [URL host];</div><div class="line">        // do something with this username</div><div class="line">        // ...</div><div class="line">        return NO;</div><div class="line">    &#125;</div><div class="line">    return YES; // let the system open this URL</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h1 id="iOS8新特性"><a href="#iOS8新特性" class="headerlink" title="iOS8新特性"></a>iOS8新特性</h1><hr>
<h5 id="一、UIAlertController对alert-amp-actionSheet的封装"><a href="#一、UIAlertController对alert-amp-actionSheet的封装" class="headerlink" title="一、UIAlertController对alert&amp;actionSheet的封装"></a>一、UIAlertController对alert&amp;actionSheet的封装</h5><p>UIAlertController.h</p>
<p>提示框按钮的选择<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM(NSInteger, UIAlertActionStyle) &#123;</div><div class="line">    </div><div class="line">    UIAlertActionStyleDefault = 0,</div><div class="line">    </div><div class="line">    UIAlertActionStyleCancel,</div><div class="line">    </div><div class="line">    UIAlertActionStyleDestructive</div><div class="line">    </div><div class="line">&#125; NS_ENUM_AVAILABLE_IOS(8_0);</div></pre></td></tr></table></figure></p>
<p>提示框的样式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM(NSInteger, UIAlertControllerStyle) &#123;</div><div class="line">    </div><div class="line">    UIAlertControllerStyleActionSheet = 0,</div><div class="line">    </div><div class="line">    UIAlertControllerStyleAlert</div><div class="line">    </div><div class="line">&#125; NS_ENUM_AVAILABLE_IOS(8_0);</div><div class="line"> </div><div class="line">NS_CLASS_AVAILABLE_IOS(8_0) @interface UIAlertAction : NSObject &lt;NSCopying&gt;</div></pre></td></tr></table></figure>
<p>创建提示框按钮</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">+ (instancetype)actionWithTitle:(NSString *)title style:(UIAlertActionStyle)style handler:(void (^)(UIAlertAction *action))handler;</div><div class="line"> </div><div class="line">@property (nonatomic, readonly) NSString *title;</div><div class="line"> </div><div class="line">@property (nonatomic, readonly) UIAlertActionStyle style;</div><div class="line"> </div><div class="line">@property (nonatomic, getter=isEnabled) BOOL enabled;</div><div class="line"> </div><div class="line">@end</div><div class="line"> </div><div class="line">NS_CLASS_AVAILABLE_IOS(8_0) @interface UIAlertController : UIViewController</div></pre></td></tr></table></figure>
<p>创建提示框</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">+ (instancetype)alertControllerWithTitle:(NSString *)title message:(NSString *)message preferredStyle:(UIAlertControllerStyle)preferredStyle;</div></pre></td></tr></table></figure>
<p>添加按钮</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (void)addAction:(UIAlertAction *)action;</div><div class="line"> </div><div class="line">@property (nonatomic, readonly) NSArray *actions;</div></pre></td></tr></table></figure>
<p>添加文本输入框</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (void)addTextFieldWithConfigurationHandler:(void (^)(UITextField *textField))configurationHandler;</div><div class="line"> </div><div class="line">@property (nonatomic, readonly) NSArray *textFields;</div><div class="line"> </div><div class="line">@property (nonatomic, copy) NSString *title;</div><div class="line"> </div><div class="line">@property (nonatomic, copy) NSString *message;</div><div class="line"> </div><div class="line">@property (nonatomic, readonly) UIAlertControllerStyle preferredStyle;</div></pre></td></tr></table></figure>
<p>简单实用示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 1.创建提示框对象，默认是actionSheet效果</div><div class="line">UIAlertController *alert = [UIAlertController alertControllerWithTitle:@&quot;注意&quot; message:@&quot;我的呈现方式变了&quot; preferredStyle:UIAlertControllerStyleAlert];</div><div class="line"> </div><div class="line">// 2.创建取消按钮并添加到提示框上</div><div class="line">[alert addAction:[UIAlertAction actionWithTitle:@&quot;取消&quot; style:UIAlertActionStyleCancel handler:^(UIAlertAction *action) &#123;</div><div class="line">    </div><div class="line">    NSLog(@&quot;取消按钮被点击了&quot;);</div><div class="line">&#125;]];</div><div class="line"></div><div class="line">// 3.呈现提示框</div><div class="line">[self presentViewController:alert animated:YES completion:nil];</div></pre></td></tr></table></figure></p>
<h5 id="二、UIPopoverController直接通过present方式呈现"><a href="#二、UIPopoverController直接通过present方式呈现" class="headerlink" title="二、UIPopoverController直接通过present方式呈现"></a>二、UIPopoverController直接通过present方式呈现</h5><p>UIViewController.h</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM(NSInteger, UIModalPresentationStyle) &#123;</div><div class="line">    </div><div class="line">    UIModalPresentationFullScreen = 0,</div><div class="line">    </div><div class="line">    UIModalPresentationPageSheet NS_ENUM_AVAILABLE_IOS(3_2),</div><div class="line">    </div><div class="line">    UIModalPresentationFormSheet NS_ENUM_AVAILABLE_IOS(3_2),</div><div class="line">    </div><div class="line">    UIModalPresentationCurrentContext NS_ENUM_AVAILABLE_IOS(3_2),</div><div class="line">    </div><div class="line">    UIModalPresentationCustom NS_ENUM_AVAILABLE_IOS(7_0),</div><div class="line">    </div><div class="line">    UIModalPresentationOverFullScreen NS_ENUM_AVAILABLE_IOS(8_0),</div><div class="line">    </div><div class="line">    UIModalPresentationOverCurrentContext NS_ENUM_AVAILABLE_IOS(8_0),</div><div class="line">    </div><div class="line">    UIModalPresentationPopover NS_ENUM_AVAILABLE_IOS(8_0),</div><div class="line">    </div><div class="line">    UIModalPresentationNone NS_ENUM_AVAILABLE_IOS(7_0) = -1,</div><div class="line">    </div><div class="line">&#125;;</div><div class="line"> </div><div class="line">@property (nonatomic,readonly) UIPopoverPresentationController *popoverPresentationController NS_AVAILABLE_IOS(8_0);</div></pre></td></tr></table></figure>
<p>使用示例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 1.创建内容控制器</div><div class="line">UITableViewController *contentVc = [[UITableViewController alloc] init];</div><div class="line"> </div><div class="line">// 2.1 设置呈现方式</div><div class="line">contentVc.modalPresentationStyle = UIModalPresentationPopover;</div><div class="line"> </div><div class="line">// 2.2设置在导航栏的左边按钮呈现</div><div class="line">contentVc.popoverPresentationController.barButtonItem = self.navigationItem.leftBarButtonItem;</div><div class="line"> </div><div class="line">// 3.呈现</div><div class="line">[self presentViewController:contentVc animated:YES completion:nil];</div></pre></td></tr></table></figure>
<p>以前的方式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">// 1.创建内容控制器</div><div class="line">UITableViewController *contentVc = [[UITableViewController alloc] init];</div><div class="line"> </div><div class="line">// 2.创建popover</div><div class="line">UIPopoverController *popover = [[UIPopoverController alloc] initWithContentViewController:contentVc];</div><div class="line"> </div><div class="line">popover.popoverContentSize = CGSizeMake(100, 100);</div><div class="line"> </div><div class="line">// 3.呈现</div><div class="line">[popover presentPopoverFromBarButtonItem:self.navigationItem.leftBarButtonItem permittedArrowDirections:UIPopoverArrowDirectionAny animated:YES];</div></pre></td></tr></table></figure>
<h5 id="三、获取用户授权的用户隐私保护"><a href="#三、获取用户授权的用户隐私保护" class="headerlink" title="三、获取用户授权的用户隐私保护"></a>三、获取用户授权的用户隐私保护</h5><p>地图定位示例 ：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">// 导入定位框架</div><div class="line">#import &lt;CoreLocation/CoreLocation.h&gt;</div><div class="line"> </div><div class="line">@interface ViewController ()&lt;CLLocationManagerDelegate&gt;</div><div class="line"> </div><div class="line">// 设置定位对象</div><div class="line">@property(nonatomic,strong)CLLocationManager* maneger;</div><div class="line"> </div><div class="line">@end</div><div class="line"> </div><div class="line">@implementation ViewController</div><div class="line"> </div><div class="line">- (void)viewDidLoad &#123;</div><div class="line">    [super viewDidLoad];</div><div class="line">    </div><div class="line">    // 当使用iOS8定位的时候需要请求用户授权，且在info.plist里添加字段NSLocationAlwaysUsageDescription 请求用户授权的描述</div><div class="line">    // iOS7仅仅需要在info.plist里添加字段Privacy - Location Usage Description 请求用户授权的描述</div><div class="line">    // 不需要再写下面的代码</div><div class="line">    if (IOS8) &#123;</div><div class="line">        [self.maneger requestAlwaysAuthorization];//请求用户授权 </div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    // 开启定位</div><div class="line">    [self.maneger startUpdatingLocation];</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h5 id="四、针对屏幕适配应运而生的size-classes"><a href="#四、针对屏幕适配应运而生的size-classes" class="headerlink" title="四、针对屏幕适配应运而生的size classes"></a>四、针对屏幕适配应运而生的size classes</h5><p>size classes是为了解决storyboard只能订制一种屏幕样式的问题，它不再是具体的尺寸，而是抽象尺寸通过宽/高 的compact、any、regular 组成了九种组合包含了所有苹果设备的尺寸。</p>
<h1 id="iOS9新特性"><a href="#iOS9新特性" class="headerlink" title="iOS9新特性"></a>iOS9新特性</h1><hr>
<h5 id="一、网络适配"><a href="#一、网络适配" class="headerlink" title="一、网络适配"></a>一、网络适配</h5><p>iOS9系统发送的网络请求将统一使用TLS 1.2 SSL。采用TLS 1.2 协议，目的是强制增强数据访问安全，而且系统Foundation框架下的相关网络请求，将不再默认使用HTTP等不安全的网络协议，而默认采用TLS 1.2。服务器因此需要更新，以解析相关数据。如不更新，可通过在 info.plist 中声明，倒退回不安全的网络请求。</p>
<p>什么是SSL/TLS？跟HTTP和HTTPS有什么关系？</p>
<p>跟往常一样，先说结论：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HTTP + SSL/TLS + TCP = HTTPS</div></pre></td></tr></table></figure>
<p>TLS 是 SSL 新的别称。举个例子：</p>
<p>“TLS1.0”之于“SSL3.1”，犹“公元2015”之于“民国104”，或者是“一千克”之于“一公斤”，或者是“半斤”之于“八两”：称呼不同，但意思相同。</p>
<p>SSL 3.0版本之后的迭代版本被重新命名为TLS 1.0，也就是说：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">TLS 1.0 ＝ SSL 3.1</div></pre></td></tr></table></figure>
<p>所以他们是一个东西，我们平常也经常简单见到 “SSL/TLS” 这种说法。常用的是下面这些：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">SSL 2.0</div><div class="line"> </div><div class="line">SSL 3.0</div><div class="line"> </div><div class="line">TLS 1.0 (SSL 3.1)</div><div class="line"> </div><div class="line">TLS 1.1 (SSL 3.1)</div><div class="line"> </div><div class="line">TLS 1.2 (SSL 3.1)</div></pre></td></tr></table></figure>
<p>那为什么标题是“使用HTTPS”而没有提及SSL和TLS什么事？ 要理解这个，要看下一个公式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">HTTP + SSL/TLS + TCP = HTTPS</div></pre></td></tr></table></figure>
<p>打个比方：如果原来的 HTTP 是塑料水管，容易被戳破；那么如今新设计的 HTTPS 就像是在原有的塑料水管之外，再包一层金属水管。一来，原有的塑料水管照样运行；二来，用金属加固了之后，不容易被戳破。</p>
<p>目前，应用最广泛的是TLS 1.0，接下来是SSL 3.0。但是，主流浏览器都已经实现了TLS 1.2的支持。Apple让你的HTTP采用SSL/TLS协议，就是让你从HTTP转到HTTPS。</p>
<p>以前的HTTP不是也能用吗？为什么要用SSL/TLS，闲得慌？！Apple是不是又在反人类？</p>
<p>不使用SSL/TLS的HTTP通信，就是不加密的通信！</p>
<p>所有信息明文传播，带来了三大风险：</p>
<p>窃听风险（eavesdropping）：第三方可以获知通信内容。</p>
<p>篡改风险（tampering）：第三方可以修改通信内容。</p>
<p>冒充风险（pretending）：第三方可以冒充他人身份参与通信。</p>
<p>SSL/TLS协议是为了解决这三大风险而设计的，希望达到：</p>
<p>所有信息都是加密传播，第三方无法窃听。</p>
<p>具有校验机制，一旦被篡改，通信双方会立刻发现。</p>
<p>配备身份证书，防止身份被冒充。</p>
<p>如何适配？—弱弱地问下：加班要多久？</p>
<p>正如文章开头所说：</p>
<p>TLS 1.2 协议 强制增强数据访问安全 系统 Foundation 框架下的相关网络请求，将不再默认使用 HTTP 等不安全的网络协议，而默认采用 TLS 1.2。服务器因此需要更新，以解析相关数据。如不更新，可通过在 Info.plist 中声明，倒退回不安全的网络请求。</p>
<p>方案一：立即让公司的服务端升级使用TLS 1.2。</p>
<p>方案二：虽Apple不建议，但可通过在 Info.plist 中声明，倒退回不安全的网络请求依然能让App访问指定http，甚至任意的http。</p>
<p>info.plist 配置中的XML源码如下所示:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1115674-75a082354660ff99.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="6.jpg"></p>
<p>上面是比较严谨的做法，指定了能访问哪些特定的HTTP。当然也有暴力的做法： 彻底倒退回不安全的HTTP网络请求，能任意进行HTTP请求，比如你在开发一款浏览器App，或者你想偷懒，或者后台想偷懒，或者公司不给你升级服务器。但目前Apple的官方文档并未提及如何在 info.plist 配置可以参考本文：<a href="http://blog.6ag.cn/1065.html" target="_blank" rel="external">http://blog.6ag.cn/1065.html</a></p>
<h5 id="二、更灵活的后台定位"><a href="#二、更灵活的后台定位" class="headerlink" title="二、更灵活的后台定位"></a>二、更灵活的后台定位</h5><p>如果不适配iOS9，就不能偷偷在后台定位。不过苹果将允许出现这种场景：</p>
<p>同一App中的多个location manager，一些只能在前台定位，另一些可在后台定位，并可随时开启或者关闭特定location manager的后台定位。</p>
<p>如何偷偷在后台定位：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">// 1. 实例化定位管理器</div><div class="line">_locationManager = [[CLLocationManager alloc] init];</div><div class="line"> </div><div class="line">// 2. 设置代理</div><div class="line">_locationManager.delegate = self;</div><div class="line"> </div><div class="line">// 3. 定位精度</div><div class="line">[_locationManager setDesiredAccuracy:kCLLocationAccuracyBest];</div><div class="line"> </div><div class="line">// 4.请求用户权限：分为：?只在前台开启定位?在后台也可定位，</div><div class="line">//注意：建议只请求?和?中的一个，如果两个权限都需要，只请求?即可，</div><div class="line">//??这样的顺序，将导致bug：第一次启动程序后，系统将只请求?的权限，?的权限系统不会请求，只会在下一次启动应用时请求?</div><div class="line">if ([[[UIDevice currentDevice] systemVersion] floatValue] &gt;= 8) &#123;</div><div class="line">    //[_locationManager requestWhenInUseAuthorization];//?只在前台开启定位</div><div class="line">    [_locationManager requestAlwaysAuthorization];//?在后台也可定位</div><div class="line">&#125;</div><div class="line"> </div><div class="line">// 5.iOS9新特性：将允许出现这种场景：同一app中多个location manager：一些只能在前台定位，另一些可在后台定位（并可随时禁止其后台定位）。</div><div class="line">if ([[[UIDevice currentDevice] systemVersion] floatValue] &gt;= 9) &#123;</div><div class="line">    _locationManager.allowsBackgroundLocationUpdates = YES;</div><div class="line">&#125;</div><div class="line"> </div><div class="line">// 6. 更新用户位置</div><div class="line">[_locationManager startUpdatingLocation];</div></pre></td></tr></table></figure>
<p>但是如果照着这种方式尝试，而没有配置info.plist，100%你的程序会崩溃掉，并报错：</p>
<p><em>*</em> Assertion failure in -[CLLocationManager setAllowsBackgroundLocationUpdates:], /BuildRoot/Library/Caches/com.apple.xbs/Sources/CoreLocationFramework_Sim/CoreLocation-1808.1.5/Framework/CoreLocation/CLLocationManager.m:593</p>
<p>要将 info.plist 配置如下：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1115674-a031a45dc10b6d47.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="7.png"></p>
<p>对应的 Info.plist 的XML源码是：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1115674-6e80d5e7418c640c.jpg?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="8.jpg"></p>
<h5 id="三、Bitcode"><a href="#三、Bitcode" class="headerlink" title="三、Bitcode"></a>三、Bitcode</h5><p>bitcode的理解应该是把程序编译成的一种过渡代码，然后苹果再把这个过渡代码编译成可执行的程序。bitcode也允许苹果在后期重新优化我们程序的二进制文件，有类似于App瘦身的思想。未来Watch应用须包含Bitcode，iOS不强制，但Xcode7默认会开启Bitcode。</p>
<p>用了xcode7的编译器编译之前没问题的项目可能会出现下列报错。</p>
<p>XXXX’ does not contain bitcode. You must rebuild it with bitcode enabled (Xcode setting ENABLE_BITCODE), obtain an updated library from the vendor, or disable bitcode forthistarget. forarchitecture arm64</p>
<p>问题的原因是：某些第三方库还不支持bitcode。要不然是等待库的开发者升级了此项功能我们更新库，要不就是把这个bitcode禁用。禁用Bitcode，方法见下图：</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1115674-7ff5bfa5eb57e418.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="9.png"></p>
<h5 id="四、企业级分发"><a href="#四、企业级分发" class="headerlink" title="四、企业级分发"></a>四、企业级分发</h5><p>iOS9之前，企业级分发十分方便：点击App出现“信任按钮”。</p>
<p>iOS9以后，企业级分发ipa包将遭到与Mac上dmg安装包一样的待遇。默认不能安装，也不再出现“信任按钮”，必须让用户进行gif图中的设置。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1115674-9d34f78d3daffa2f.gif?imageMogr2/auto-orient/strip" alt="10.gif"></p>
<h5 id="五、URL-scheme"><a href="#五、URL-scheme" class="headerlink" title="五、URL scheme"></a>五、URL scheme</h5><p>URL scheme一般使用的场景是应用程序有分享或跳其他平台授权的功能，分享或授权后再跳回来。在iOS8并没有做过多限制，在iOS9中，如果使用URL scheme必须在”info.plist”中将你要在外部调用的URL scheme列为白名单，否则不能使用。</p>
<p>canOpenURL: failed forURL : “mqzone://qqapp”- error: “This app is not allowed to query for scheme mqzone”</p>
<p>具体的解决方案也是要在info.plist中设置 LSApplicationQueriesSchemes 类型为数组，下面添加所有你用到的scheme</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1115674-c756c23b4a7d1e69.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="11.png"></p>
<p>推荐一篇博客: <a href="http://awkwardhare.com/post/121196006730/quick-take-on-ios-9-url-scheme-changes" target="_blank" rel="external">http://awkwardhare.com/post/121196006730/quick-take-on-ios-9-url-scheme-changes</a></p>
<p>其中最关键的是以下部分：</p>
<p>If you call the “canOpenURL” method on a URL that is not in your whitelist, it will return “NO”, even if there is an app installed that has registered to handle this scheme. A “This app is not allowed to query for scheme xxx” syslog entry will appear.</p>
<p>If you call the “openURL” method on a URL that is not in your whitelist, it will fail silently. A “This app is not allowed to query for scheme xxx” syslog entry will appear.</p>
<h5 id="六、新字体"><a href="#六、新字体" class="headerlink" title="六、新字体"></a>六、新字体</h5><p>iOS8中，字体是Helvetica，中文的字体有点类似于“华文细黑”。只是苹果手机自带渲染，所以看上去可能比普通的华文细黑要美观。iOS9中，中文系统字体变为了专为中国设计的“苹方” 有点类似于一种word字体“幼圆”。字体有轻微的加粗效果，并且最关键的是字体间隙变大了！</p>
<p>所以很多原本写死了width的label可能会出现“…”的情况。</p>
<p><img src="http://upload-images.jianshu.io/upload_images/1115674-c6900be6583fac27.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="12.png"></p>
<p><img src="http://upload-images.jianshu.io/upload_images/1115674-28a5e236ded65e2c.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="13.png"></p>
<p>上面这两张图也可以直观的看出同一个界面，同一个label的变化。</p>
<p>所以为了在界面显示上不出错，就算是固定长度的文字也还是建议使用sizetofit 或者ios向上取整 ceilf() 或者提前计算。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">CGSize size = [title sizeWithAttributes:@&#123;NSFontAttributeName: [UIFont systemFontOfSize:14.0f]&#125;];</div><div class="line">CGSize adjustedSize = CGSizeMake(ceilf(size.width), ceilf(size.height));</div></pre></td></tr></table></figure>
<h5 id="七、tableview"><a href="#七、tableview" class="headerlink" title="七、tableview"></a>七、tableview</h5><p>虽然现在的iOS9已经推送正式版了，但是iOS9使用时还是会感觉到App比以前更加卡顿了，tableView拖动时卡顿显示的最为明显。 并且之前遇到一个bug，原本好的项目用xcode7一编译，tableView刷新出了问题 ，[tableView reloadData]无效，有一行cell明明改变了但是刷新不出来。 感觉可能是这个方法和某种新加的特性冲突了，猜测可能是reloadData的操作被推迟到下一个RunLoop执行最终失效。</p>
<p>解决的方法是，注释[tableView reloadData]，改用局部刷新，问题居然就解决了。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[self.tableView reloadSections:[NSIndexSet indexSetWithIndex:0] withRowAnimation:UITableViewRowAnimationNone];</div></pre></td></tr></table></figure>
<h5 id="八、iPad适配Slide-Over-和-Split-View"><a href="#八、iPad适配Slide-Over-和-Split-View" class="headerlink" title="八、iPad适配Slide Over 和 Split View"></a>八、iPad适配Slide Over 和 Split View</h5><p>iPad适配Slide Over 和 Split View，若想适配multi tasking特性，唯一的建议：</p>
<p>弃纯代码，改用storyboard、xib，纵观苹果WWDC所有Demo均是如此。</p>
<p>Mysteries of Auto Layout, Part 1<br>What’s New in Storyboards<br>Implementing UI Designs in Interface Builder<br>Getting Started with Multitasking on iPad in iOS 9<br>Optimizing Your App for Multitasking on iPad in iOS</p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/适配/" rel="tag">#适配</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/01/11/coredata/" rel="next" title="Coredata">
                <i class="fa fa-chevron-left"></i> Coredata
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/05/21/Ngnix/" rel="prev" title="Mac上搭建直播服务器Nginx">
                Mac上搭建直播服务器Nginx <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/02/15/ios6789/"
           data-title="iOS6、7、8、9新特性汇总和适配说明" data-url="http://jimmypeng.cn/2016/02/15/ios6789/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://upload.jianshu.io/users/upload_avatars/1115674/6322d5678682.jpg"
               alt="Jimmy Peng" />
          <p class="site-author-name" itemprop="name">Jimmy Peng</p>
          <p class="site-description motion-element" itemprop="description">JimmyPeng | iOS Blog | html5</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">14</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              
                <span class="site-state-item-count">4</span>
                <span class="site-state-item-name">标签</span>
              
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/JimmyPeng4iOS" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.weibo.com/JimmyPeng4iOS" target="_blank" title="Weibo">
                  
                    <i class="fa fa-fw fa-weibo"></i>
                  
                  Weibo
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/53845c6b43dc/top_articles" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  简书
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#iOS6新特性"><span class="nav-number">1.</span> <span class="nav-text">iOS6新特性</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#一、关于内存警告"><span class="nav-number">1.0.0.0.1.</span> <span class="nav-text">一、关于内存警告</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#二、关于屏幕旋转"><span class="nav-number">1.0.0.0.2.</span> <span class="nav-text">二、关于屏幕旋转</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#三、UISwitch"><span class="nav-number">1.0.0.0.3.</span> <span class="nav-text">三、UISwitch</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#四、UINavigationBar"><span class="nav-number">1.0.0.0.4.</span> <span class="nav-text">四、UINavigationBar</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#五、UIImage"><span class="nav-number">1.0.0.0.5.</span> <span class="nav-text">五、UIImage</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#六、UIRefreshControl"><span class="nav-number">1.0.0.0.6.</span> <span class="nav-text">六、UIRefreshControl</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#七、UICollectionView"><span class="nav-number">1.0.0.0.7.</span> <span class="nav-text">七、UICollectionView</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#iOS7新特性"><span class="nav-number">2.</span> <span class="nav-text">iOS7新特性</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#一、已禁用-UIDevice-uniqueIdentifier"><span class="nav-number">2.0.0.0.1.</span> <span class="nav-text">一、已禁用-[UIDevice uniqueIdentifier]</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#二、UIPasteboard由共享变为沙盒化了"><span class="nav-number">2.0.0.0.2.</span> <span class="nav-text">二、UIPasteboard由共享变为沙盒化了</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#三、MAC地址不能再用来设别设备"><span class="nav-number">2.0.0.0.3.</span> <span class="nav-text">三、MAC地址不能再用来设别设备</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#四、iOS现在要求app如需使用麦克风，需要征得用户同意"><span class="nav-number">2.0.0.0.4.</span> <span class="nav-text">四、iOS现在要求app如需使用麦克风，需要征得用户同意</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#五、-NSArray-firstObject-的实现"><span class="nav-number">2.0.0.0.5.</span> <span class="nav-text">五、[NSArray firstObject]的实现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#六、增加了instancetype"><span class="nav-number">2.0.0.0.6.</span> <span class="nav-text">六、增加了instancetype</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#七、设置UIImage的渲染模式：UIImage-renderingMode"><span class="nav-number">2.0.0.0.7.</span> <span class="nav-text">七、设置UIImage的渲染模式：UIImage.renderingMode</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#八、tintcolor-VS-barTintColor"><span class="nav-number">2.0.0.0.8.</span> <span class="nav-text">八、tintcolor VS barTintColor</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#九、去掉了纹理颜色"><span class="nav-number">2.0.0.0.9.</span> <span class="nav-text">九、去掉了纹理颜色</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#十、UIButtonTypeRoundRect被UIButtonTypeSystem取代了"><span class="nav-number">2.0.0.0.10.</span> <span class="nav-text">十、UIButtonTypeRoundRect被UIButtonTypeSystem取代了</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#十一、检查无线路由是否可用"><span class="nav-number">2.0.0.0.11.</span> <span class="nav-text">十一、检查无线路由是否可用</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#十二、了解蜂窝网络"><span class="nav-number">2.0.0.0.12.</span> <span class="nav-text">十二、了解蜂窝网络</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#十三、通过iCloud同步用户设备的密码"><span class="nav-number">2.0.0.0.13.</span> <span class="nav-text">十三、通过iCloud同步用户设备的密码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#十四、使用NSAttributedString显示HTML"><span class="nav-number">2.0.0.0.14.</span> <span class="nav-text">十四、使用NSAttributedString显示HTML</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#十五、使用原生的Base64"><span class="nav-number">2.0.0.0.15.</span> <span class="nav-text">十五、使用原生的Base64</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#十六、使用UIApplicationUserDidTakeScreenshotNotification来检查截图"><span class="nav-number">2.0.0.0.16.</span> <span class="nav-text">十六、使用UIApplicationUserDidTakeScreenshotNotification来检查截图</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#十七、实现多语言语音合成"><span class="nav-number">2.0.0.0.17.</span> <span class="nav-text">十七、实现多语言语音合成</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#十八、使用了新的UIScreenEdgePanGestureRecognizer"><span class="nav-number">2.0.0.0.18.</span> <span class="nav-text">十八、使用了新的UIScreenEdgePanGestureRecognizer</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#十九、使用UIScrollViewKeyboardDismissMode实现了Message-app的行为"><span class="nav-number">2.0.0.0.19.</span> <span class="nav-text">十九、使用UIScrollViewKeyboardDismissMode实现了Message app的行为</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#二十、使用Core-Image来检测眨眼以及微笑"><span class="nav-number">2.0.0.0.20.</span> <span class="nav-text">二十、使用Core Image来检测眨眼以及微笑</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#二十一、给UITextView增加了链接"><span class="nav-number">2.0.0.0.21.</span> <span class="nav-text">二十一、给UITextView增加了链接</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#iOS8新特性"><span class="nav-number">3.</span> <span class="nav-text">iOS8新特性</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#一、UIAlertController对alert-amp-actionSheet的封装"><span class="nav-number">3.0.0.0.1.</span> <span class="nav-text">一、UIAlertController对alert&actionSheet的封装</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#二、UIPopoverController直接通过present方式呈现"><span class="nav-number">3.0.0.0.2.</span> <span class="nav-text">二、UIPopoverController直接通过present方式呈现</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#三、获取用户授权的用户隐私保护"><span class="nav-number">3.0.0.0.3.</span> <span class="nav-text">三、获取用户授权的用户隐私保护</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#四、针对屏幕适配应运而生的size-classes"><span class="nav-number">3.0.0.0.4.</span> <span class="nav-text">四、针对屏幕适配应运而生的size classes</span></a></li></ol></li></ol></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#iOS9新特性"><span class="nav-number">4.</span> <span class="nav-text">iOS9新特性</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#一、网络适配"><span class="nav-number">4.0.0.0.1.</span> <span class="nav-text">一、网络适配</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#二、更灵活的后台定位"><span class="nav-number">4.0.0.0.2.</span> <span class="nav-text">二、更灵活的后台定位</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#三、Bitcode"><span class="nav-number">4.0.0.0.3.</span> <span class="nav-text">三、Bitcode</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#四、企业级分发"><span class="nav-number">4.0.0.0.4.</span> <span class="nav-text">四、企业级分发</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#五、URL-scheme"><span class="nav-number">4.0.0.0.5.</span> <span class="nav-text">五、URL scheme</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#六、新字体"><span class="nav-number">4.0.0.0.6.</span> <span class="nav-text">六、新字体</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#七、tableview"><span class="nav-number">4.0.0.0.7.</span> <span class="nav-text">七、tableview</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#八、iPad适配Slide-Over-和-Split-View"><span class="nav-number">4.0.0.0.8.</span> <span class="nav-text">八、iPad适配Slide Over 和 Split View</span></a></li></ol></li></ol></li></ol></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2010 - 
  <span itemprop="copyrightYear">2016</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jimmy Peng</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>


        

<div class="busuanzi-count">

  <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

  
    <span class="site-uv"><i class="fa fa-user"></i><span class="busuanzi-value" id="busuanzi_value_site_uv"></span></span>
  

  
    <span class="site-pv"><i class="fa fa-eye"></i><span class="busuanzi-value" id="busuanzi_value_site_pv"></span></span>
  
  
</div>



        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"jimmyp"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    <script src="/vendors/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  






  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });

                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>


  

  

  

</body>
</html>
